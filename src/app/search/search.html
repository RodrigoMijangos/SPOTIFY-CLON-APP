<div class="search-container">
  <!-- Barra de búsqueda -->
  <div class="search-header">
    <div class="search-bar">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
      <input 
        type="text" 
        placeholder="¿Qué te apetece escuchar?"
        class="search-input"
        [(ngModel)]="searchQuery"
        (input)="onSearchInput($event)"
        autocomplete="off"
      >
      @if (searchQuery) {
        <button class="clear-btn" (click)="clearSearch()" title="Limpiar búsqueda">
          <i class="fa-solid fa-xmark"></i>
        </button>
      }
    </div>
  </div>

  <!-- Loading -->
  @if (isSearching) {
    <div class="loading-section">
      <div class="loading-spinner">
        <i class="fa-solid fa-spinner fa-spin"></i>
      </div>
      <p>Buscando...</p>
    </div>
  }

  <!-- Resultados de búsqueda -->
  @if (showResults && !isSearching) {
    <div class="search-results">
      
      <!-- Mejor resultado -->
      @if (searchResults.tracks?.length > 0) {
        <div class="top-result-section">
          <h2>Mejor resultado</h2>
          <div class="top-result" (click)="playTrack(searchResults.tracks[0])">
            <div class="result-image">
              @if (searchResults.tracks[0].album?.images?.[0]) {
                <img [src]="searchResults.tracks[0].album.images[0].url" [alt]="searchResults.tracks[0].name">
              } @else {
                <div class="placeholder-image">
                  <i class="fa-solid fa-music"></i>
                </div>
              }
              <div class="play-overlay">
                <i class="fa-solid fa-play"></i>
              </div>
            </div>
            <div class="result-info">
              <h3>{{ searchResults.tracks[0].name }}</h3>
              <p>Canción • {{ getArtistNames(searchResults.tracks[0].artists) }}</p>
            </div>
          </div>
        </div>
      }

      <!-- Canciones -->
      @if (searchResults.tracks?.length > 1) {
        <div class="results-section">
          <h2>Canciones</h2>
          <div class="tracks-list">
            @for (track of searchResults.tracks.slice(1, 5); track track.id) {
              <div class="track-result" (click)="playTrack(track)">
                <div class="track-image">
                  @if (track.album?.images?.[0]) {
                    <img [src]="track.album.images[0].url" [alt]="track.name">
                  } @else {
                    <div class="placeholder-image">
                      <i class="fa-solid fa-music"></i>
                    </div>
                  }
                  <div class="play-overlay">
                    <i class="fa-solid fa-play"></i>
                  </div>
                </div>
                <div class="track-info">
                  <h4>{{ track.name }}</h4>
                  <p>{{ getArtistNames(track.artists) }}</p>
                </div>
                <div class="track-duration">
                  {{ formatDuration(track.duration_ms) }}
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Artistas -->
      @if (searchResults.artists?.length > 0) {
        <div class="results-section">
          <h2>Artistas</h2>
          <div class="artists-grid">
            @for (artist of searchResults.artists.slice(0, 4); track artist.id) {
              <div class="artist-result" (click)="followArtist(artist)">
                <div class="artist-image">
                  @if (artist.images?.[0]) {
                    <img [src]="artist.images[0].url" [alt]="artist.name">
                  } @else {
                    <div class="placeholder-image">
                      <i class="fa-solid fa-user"></i>
                    </div>
                  }
                </div>
                <div class="artist-info">
                  <h4>{{ artist.name }}</h4>
                  <p>Artista</p>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Álbumes -->
      @if (searchResults.albums?.length > 0) {
        <div class="results-section">
          <h2>Álbumes</h2>
          <div class="albums-grid">
            @for (album of searchResults.albums.slice(0, 4); track album.id) {
              <div class="album-result" (click)="playAlbum(album)">
                <div class="album-image">
                  @if (album.images?.[0]) {
                    <img [src]="album.images[0].url" [alt]="album.name">
                  } @else {
                    <div class="placeholder-image">
                      <i class="fa-solid fa-compact-disc"></i>
                    </div>
                  }
                  <div class="play-overlay">
                    <i class="fa-solid fa-play"></i>
                  </div>
                </div>
                <div class="album-info">
                  <h4>{{ album.name }}</h4>
                  <p>{{ album.release_date?.substring(0, 4) }} • {{ getArtistNames(album.artists) }}</p>
                </div>
              </div>
            }
          </div>
        </div>
      }

    </div>
  }

  <!-- Estado inicial -->
  @if (!showResults && !isSearching && !searchQuery) {
    <div class="initial-state">
      <div class="browse-section">
        <h2>Explorar todo</h2>
        <div class="browse-categories">
          <div class="category-card" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
            <h3>Música</h3>
            <i class="fa-solid fa-music"></i>
          </div>
          <div class="category-card" style="background: linear-gradient(135deg, #4ecdc4, #44bd87);">
            <h3>Podcasts</h3>
            <i class="fa-solid fa-podcast"></i>
          </div>
          <div class="category-card" style="background: linear-gradient(135deg, #a8e6cf, #88cc80);">
            <h3>En vivo</h3>
            <i class="fa-solid fa-broadcast-tower"></i>
          </div>
          <div class="category-card" style="background: linear-gradient(135deg, #ffd93d, #f39c12);">
            <h3>Para ti</h3>
            <i class="fa-solid fa-heart"></i>
          </div>
        </div>
      </div>
    </div>
  }
</div>